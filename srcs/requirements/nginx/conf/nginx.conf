user www-data;
# pid /run/nginx.pid;
# include etc/nginx/modules-enabled/*.conf;

# this comment line resides in 'main' context
# of this config

# block directive 'events' provides 
# the configuration file context in which 
# the directives that affect connection 
# processing (e.g. incoming connections, 
# requests etc) are specified
events {
#               'worker_connections' directive sets
#               the maximum number of simultaneous 
#               connections that can be opened by 
#               a worker process:
                worker_connections 1024;
}
# block directive 'http' provides the configuration file 
# context in which the HTTP server directives are specified:
http {
#       block directive 'server' sets configuration
#       for a virtual server:
        server {
#               'listen' sets the adress (all) and port (443)
#               for IPv4 on which the server will accept 
#               requests.
#               'ssl' parameter allows specifying that all
#               connections accepted on this port should
#               work in SSL mode.
                listen 443 ssl;
#               IPv6 addresses are specified in square 
#               brackets '[::]':
                listen [::]:443 ssl;

#               'ssl_certificate' specifies a file with
#               the certificate:
                ssl_certificate /etc/nginx/ssl/mmalphit.42.fr.crt;
#               'ssl_certificate_key' specifies a file
#               with the secret key:
                ssl_certificate_key /etc/nginx/ssl/mmalphit.42.fr.key;
#               'ssl_protocols' enables the specified protocols:
		ssl_protocols TLSv1.2 TLSv1.3;

#               2 directives specify the locations of the logs
#               and their format (option not used here):
                access_log /var/log/nginx/access.log;
                error_log /var/log/nginx/error.log;
#               enables compression:
                gzip on;

#               sets all server names:
                server_name mmalphit.42.fr;
#               sets the root directory for the requests:
                root /var/www/html/wordpress;
#=>             root /var/www/html;
#               'index' defines all files that will be used
#               as an index:
                index index.php index.html index.htm index.nginx-debian.html;

#               'location' sets configuration depending
#               on request URI ('/' prefix to be compared with
#               the URI from the request, and for matching
#               requests the config in '{}' would be set:
                location / {
#                       to enable a default mapping table
#                       (name extensions to MIME types of responses)
#                       which is distributed with nginx in mime.types:
                        include /etc/nginx/mime.types;
#=>                     try_files $uri $uri/ =404;
#                       'try_files' checkes the existance of files
#                       in the specified order and uses the 1st 
#                       found file for requiest processing,
#                       in the current context
                        try_files $uri $uri/ /index.php$is_args$args;
                }
#               '~' introduces a case-sensitive search for 
#               a regular expression ('\.php$')
                location ~ \.php$ {
#                       'fastcgi_split_path_info' defines 
#                       a regular expression that captures a value for 
#                       the $fastcgi_path_info variable. 
#                       The regular expression should have two captures: 
#                       the first becomes a value of the 
#                       $fastcgi_script_name variable, the second becomes 
#                       a value of the $fastcgi_path_info variable
                        fastcgi_split_path_info ^(.+\.php)(/.+)$;
#                       sets the address of a FastCGI server. 
#                       The address can be specified as a domain name 
#                       or IP address, and a port:
                        fastcgi_pass wordpress:9000;
#                       sets a file name that will be appended after 
#                       a URI that ends with a slash, in the value of
#                       the '$fastcgi_script_name' variable:
                        fastcgi_index index.php;
#                       include the fastcgi_param setting
                        include fastcgi_params;
#                       The SCRIPT_FILENAME is used in PHP for
#                       determining the script name (with its full path).
#                       'fastcgi_param' sets a parameter,
#                       which should be passed to th eFastCGI server,
#                       to a value (SCRIPT_FILENAME=$document_...) 
                        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#=>                     fastcgi_param SCRIPT_FILENAME $request_filename;
#                       to set 'SCRIPT_NAME' (to determine the script name
#                       w/o the path to it):
                        fastcgi_param SCRIPT_NAME $fastcgi_script_name;
#=>                     fastcgi_param HTTPS on;
                }
        }
}
